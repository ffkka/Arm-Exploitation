先说明下虚拟机和模拟器的区别：

1. 虚拟机是虚拟相同架构的环境，比如`x86_64`的主机虚拟`x86_64`或`x86`的环境，常见的虚拟机软件有VMware，Parallels，VirtualBox等。
2. 模拟器是模拟不同的环境，比如`x86_64`主机模拟`arm`环境，或反过来，`arm`主机虚拟`x86_64`环境。比如苹果最新的M1系列芯片，采用的是ARM 64位架构，芯片本身不支持直接运行`x86`的程序，在macOS下可以使用`Rosetta2`转译运行程序，而对于操作系统级别的，则可以使用`qemu`来模拟。

----

> 在Macbook（m1芯片）上进行QEMU下的ARM环境搭建

**安装qemu**

```
brew install qemu
```

**下载qemu-rpi-kernel**

```
wget https://raw.githubusercontent.com/dhruvvyas90/qemu-rpi-kernel/master/kernel-qemu-4.4.34-jessie
```

> qemu-rpi-kernel是一个专为Qemu设计的库，提供了一系列预编译的适用于Qemu的树莓派内核镜像。这些内核与官方Raspbian映像兼容，并进行了优化，以便在Qemu环境下流畅运行。项目还包含了构建自同一源代码的不同版本内核，以及用于Qemu模拟的设备树文件（dtb）
>

**下载versatile-pb.dtb**

```
wget https://raw.githubusercontent.com/dhruvvyas90/qemu-rpi-kernel/master/versatile-pb.dtb
```

**下载树莓派操作系统镜像**

```
wget wget https://downloads.raspberrypi.org/raspbian/images/raspbian-2017-04-10/2017-04-10-raspbian-jessie.zip
```

运行QEMU

```
qemu-system-arm -M versatilepb -cpu arm1176 -m 256 \
-hda 2017-04-10-raspbian-jessie.img \
-dtb versatile-pb.dtb \
-kernel kernel-qemu-4.4.34-jessie \
-append 'root=/dev/sda2 panic=1' \
-no-reboot -netdev user,id=unet \
-device virtio-net-pci,netdev=unet \
-net nic,model=virtio \



qemu-system-arm  -M versatilepb -cpu arm1176 -m 256 \
-hda 2017-04-10-raspbian-jessie.img \
-dtb versatile-pb.dtb \
-kernel kernel-qemu-4.4.34-jessie \
-serial stdio \
-append 'root=/dev/sda2 rootfstype=ext4 rw' \
-net user,hostfwd=tcp::5022-:22 \
-no-reboot

qemu-img convert -f raw -O qcow2 2017-04-10-raspbian-jessie.img 2017-04-10-raspbian-jessie.qcow


qemu-system-arm \
  -M versatilepb \
  -cpu arm1176 \
  -m 256 \
  -drive "file=2017-04-10-raspbian-jessie.img,if=none,index=0,media=disk,format=raw,id=disk0" \
  -device "virtio-blk-pci,drive=disk0,disable-modern=on,disable-legacy=off" \
  -net "user,hostfwd=tcp:127.0.0.1:5022-:22" \
  -net nic \
  -dtb versatile-pb.dtb \
  -kernel kernel-qemu-4.4.34-jessie \
  -append 'root=/dev/vda2 panic=1' \
  -no-reboot
```

